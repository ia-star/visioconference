<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>VisioConf v0.7</title>
		<meta name="author" content="Deniz" />
		<!-- Date: 2020-04-10 -->
		
<style>
 #copyright{
 	font-size:20px;
 	color:grey;
 	font-style: italic;
 }

.Kontrol{
	font-size: 20px;
	font-family: Arial;
}	
input, textarea, select, option {
 background-color:#FFF3F3;
 font-size: 30px;
 }	
button {
  
  border-radius: 4px;
  background-color: #e7e7e7; 
  color: black;
  
  padding: 2px 5px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 30px;
}


.resim-ekle{
	width: 100%;
    height: 100%;
    display:block;
    object-fit: cover;
}
	
.container{
	width: 100%;
	height: 100%;
	 background-color: #444;
	display:block;
}
.wrapper {
  display: grid;
  	
  grid-template-columns: repeat(6, 1fr);
  grid-template-rows: repeat(10, 1fr);
  grid-gap: 10px;
  min-width: 0;   /* NEW; needed for Firefox */
 
}

.box {
  float:right;
  border-radius: 5px;
  width:100%;
  height:100%;
  border-style: solid;
  border-color: #92a8d1;
}

.v1{ 
	display:block;width: 100%;height: 100%;  display:block;   object-fit: cover;
	grid-column-start: 1; grid-column-end: 8;grid-row-start: 1;grid-row-end: 11;
    }

.v1S{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;z-index:1;
	grid-column-start: 1; grid-column-end: 2;grid-row-start: 1;grid-row-end: 2;
}
.v2{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;
	grid-column-start: 1; grid-column-end: 8; grid-row-start: 1; grid-row-end: 11;  
}

.v3H{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;
	grid-column-start: 1; grid-column-end: 8; grid-row-start: 1; grid-row-end: 6;
}

.v3B{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;
	grid-column-start: 1; grid-column-end: 8; grid-row-start: 6; grid-row-end: 11;	
}

.v4HL{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;
	grid-column-start: 1; grid-column-end: 4; grid-row-start: 1; grid-row-end: 6;		
	}	
.v4HR{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;
	grid-column-start: 4; grid-column-end: 7; grid-row-start: 1; grid-row-end: 6;	
	}		
.v4BL{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;	
	grid-column-start: 1; grid-column-end: 4; grid-row-start: 6; grid-row-end: 11;	
	}	
.v4BR{
	display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;
	grid-column-start: 4; grid-column-end: 7; grid-row-start: 6; grid-row-end: 11;	
	}	
	
	
	
	
	
	
	
.v5{display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;}
.v6{display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;}
.v7{display:block;width: 100%;height: 100%;  display:block;    object-fit: cover;}
		
</style>
		
</head>
<body>	
<div  class="Kontrol" id="kontrol">
	<div id="entete" style="width: 300px; height: 100px;"> </div>
	<script src="https://rtcmulticonnection.herokuapp.com/dist/RTCMultiConnection.min.js"></script>
	<script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
	

	<input type="text" size="10" id="OdaIsmi" placeholder="Room Name" value="">
	<button id="btn-openjoin-room"> Open/Join Room</button>
	<hr>
<!-- Buraya remote videolarin Id lerini stok  ediyoruz -->	
<!--<input type="hidden" id="u0" value="" >-->
<input type="hidden" id="u1" value="" >
<input type="hidden" id="u2" value="" >
<input type="hidden" id="u3" value="" >
<input type="hidden" id="u4" value="" >
<input type="hidden" id="u5" value="" >
<input type="hidden" id="u6" value="" >
<input type="hidden" id="u7" value="" >
<input type="hidden" id="u8" value="" >
	
<div id="copyright"> VisioConf V0.7 - 2020 D.TULBENT</div> <!-- Ayak kismi -->


</div> <!-- Kontrol -->	
	
		
<!--************* VIDEO CONTAINER **********-->	
<section class="container" id="container">
	<div class="wrapper" id="wrapper">	</div>	
</section>

<script>

/* ******************************************************
 ------------ TARIH HESAPLA ve ENTETE Yazdir --- ------
//****************************************************** */

var today = new Date(); 
var dd = today.getDate(); 
var mm = today.getMonth()+1; //January is 0! 
var yyyy = today.getFullYear(); 
if(dd<10){dd='0'+dd} 
if(mm<10){mm='0'+mm} 
var today = dd+'/'+mm+'/'+yyyy; 
document.getElementById("entete").innerHTML = "<div style='padding: 12px 15px 20px 2px;font-size:30px;font-weight:bold;'> Visioconference<br> <span style='font-size:20px;font-weight:normal;'>   "+today+ "</span></div>";

/* ***************************************************************************
// ----------- NAVIGATORUN DILINI BUL Ve Mesajlari Ayarla----------------------
// *************************************************************************** */
var language = navigator.language;
if (language.indexOf('fr') > -1) {
	document.getElementById("btn-openjoin-room").innerHTML ="Entrez!";
	document.getElementById('OdaIsmi').placeholder = 'Nom de la salle';
	var odadancik="Quittez la Salle";
	var odaadiyok="Le Nom de la salle manque !";
	var kisisayisi=  " Utilisateur(s) connecté(s)";
	}
else if (language.indexOf('tr') > -1) {
	document.getElementById("btn-openjoin-room").innerHTML ="Salona buyrun";
	document.getElementById('OdaIsmi').placeholder = "Salon Adi ?";
	var odadancik="Salonu terket";
	var odaadiyok="Oda adi eksik !";
	var kisisayisi=  " Kisi Salondayiz";
}
else {
	document.getElementById("btn-openjoin-room").innerHTML ="Open/Join Room ";
	document.getElementById('OdaIsmi').placeholder = "Room Name ?";
	var odadancik="Leave the Room";
	var odaadiyok="Please enter Room Name !";
	var kisisayisi=  " Users connected now";
	}
	

var hasTouchscreen = 'ontouchstart' in window;
if(hasTouchscreen){var isMobile=1;}
else{var isMobile=0;}




/* *************************************
*** Ecran yerlestirme hesaplari ******
// *************************************/
if(isMobile==1){
var WW=window.innerWidth;
var WH=document.documentElement.clientHeight;
}
else{
	var WH=document.documentElement.clientHeight;
	var WW=Math.ceil(WH/1.5);
}

//alert(WW+" / "+WH);
document.getElementById('wrapper').style.height = WH+"px";
document.getElementById('wrapper').style.width = WW+"px";

/* ************************************************************
 ----------------BAGLANTIYA BASLIYORUZ ----------------------
// *********************************************************** */

var connection = new RTCMultiConnection();

// Soket server baglanti adresi
connection.socketURL = 'https://rtcmulticonnection.herokuapp.com:443/';

// ------------ Video audio degerleri ---------------------------------
connection.socketCustomParameters ='&fullName=Deniz&country=FR&meetingId=xyz';

connection.session = {
    audio: true,
    video: true
};

connection.sdpConstraints.mandatory = {
    OfferToReceiveAudio: true,
    OfferToReceiveVideo: true
};


/* ********************************************
---- kullanicinin salona girmesi olayi ------
//******************************************** */
var user_id=[];
var LocalUserID=[];
var RemoteUserID=[];
var kullanici=[];

function yerlestir(baglanti_sayisi){
		if (baglanti_sayisi==1){
         
	    var aranan_1=document.getElementById("u1").value;
	    document.getElementById(aranan_1).classList.add("v1");
		}
		
		if (baglanti_sayisi==2){
         
	    var video_1=document.getElementById("u1").value;
	    document.getElementById(video_1).classList.add("v1S");
	    document.getElementById(video_1).classList.remove("v1");
	    
	    var video_2=document.getElementById("u2").value;
	    document.getElementById(video_2).classList.add("v2");
		}
		
		
		if (baglanti_sayisi==3){         
	    var video_1=document.getElementById("u1").value;
	    //document.getElementById(video_1).classList.add("v1S");
	    
	    var video_2=document.getElementById("u2").value;
	    document.getElementById(video_2).classList.add("v3H");
	    document.getElementById(video_2).classList.remove("v2");
	    
	    var video_3=document.getElementById("u3").value;
	    document.getElementById(video_3).classList.add("v3B");
		}
		
		
		if (baglanti_sayisi==4){
		
		var video_1=document.getElementById("u1").value;
	    document.getElementById(video_1).classList.add("v4HL");
		document.getElementById(video_1).classList.remove("v1S");
		
		var video_2=document.getElementById("u2").value;
	    document.getElementById(video_2).classList.add("v4HR");
	    document.getElementById(video_2).classList.remove("v3H");
	    
	    var video_3=document.getElementById("u3").value;
	    document.getElementById(video_3).classList.add("v4BL");
	    document.getElementById(video_3).classList.remove("v3B");
	    
	    var video_4=document.getElementById("u4").value;
	    document.getElementById(video_4).classList.add("v4BR");
	    
		}		
}// yerlestir




connection.onstream = function(event) {
	// kullaniciyi video ya bagla
	document.getElementById("wrapper").appendChild(event.mediaElement);
	
	/* user id leri kayda aliyoruz user_id[0]="xtgYtRUIgHrTçdzfsvvppokj" gibi*/
	//user_id[connection.getAllParticipants().length]=event.mediaElement.id;
	//kullanici[connection.getAllParticipants().length]=event.userid;
	
	// baglanti sayisini hesapliyoruz	
	var baglanti_sayisi = document.getElementById("wrapper").childElementCount;

	if (event.type === 'remote') {
		var user_sayi="u"+baglanti_sayisi; // u1....
		document.getElementById(user_sayi).setAttribute('value',event.mediaElement.id); 
		
		RemoteUserID[baglanti_sayisi]=event.mediaElement.id;
		
	}
	else{
		var user_sayi="u"+baglanti_sayisi; // u1....
		document.getElementById(user_sayi).setAttribute('value',event.mediaElement.id); 
	
		LocalUserID[baglanti_sayisi]=event.mediaElement.id;
		
	}
	
	yerlestir(baglanti_sayisi);
	
	
	


} // onsream

connection.onleave = connection.streamended = connection.onclose = function(event) {
	
// baglanti sayisini hesapliyoruz	
	//var baglanti_sayisi = document.getElementById("wrapper").childElementCount;
	//var baglanti_sayisi=connection.getAllParticipants().length;
	//alert(baglanti_sayisi);
	//yerlestir(baglanti_sayisi);
}


//----- Leave yazisini ekle
document.body.insertAdjacentHTML("beforeend", "<div id='text-leave' style='font-size:35px;color:red;font-weight: bold;position: absolute;top:5px;z-index: 100;cursor:pointer;' >"+odadancik+"</div>");
    	
//------ Leave room yazisini kapat -----
document.getElementById('text-leave').style.visibility = "hidden";




/* *********************************************
--------ODAYI AC /  ACIK ODAYA ODAYA GIR ------
// ******************************************** */
document.getElementById('btn-openjoin-room').onclick = function() {
	var oda = document.getElementById("OdaIsmi").value
	if (oda =="") { alert(odaadiyok)}
    else {
    	connection.openOrJoin(oda);
    	document.getElementById('btn-openjoin-room').style.visibility = "hidden";
    	document.getElementById("kontrol").style.display = "none"; // Kontrolu kapat
    	document.getElementById('text-leave').style.visibility = "visible"; // leave yazisini ac
    	  	   	
    	}
};	
/* **********************************
------- KENDI  ODANI TERKET ------
// ********************************* */
document.getElementById('text-leave').onclick = function() {
	//alert("Kapat");
    // disconnect with all users
    connection.getAllParticipants().forEach(function(pid) {
        connection.disconnectWith(pid);
    });

    // Butun  local cameralari kapat 
    connection.attachStreams.forEach(function(localStream) {
        localStream.stop();
    });

    // socket.io baglantisini kapat 
    connection.closeSocket();
	location.reload();
	this.disabled = true;
};


</script>

	
</body>
</html>
